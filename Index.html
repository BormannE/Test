<!DOCTYPE html PUBLIC>
<html>
<head>
  <title>WEB Maintenance</title> 
  <meta name="description" content="TV Maintenance"/>    
  <meta name="keywords" content="Maintenance, maintenance, html, css, javascript"/>    
  <meta name="author" content="Bormann Enzo"/>    
  <meta charset="utf-8"/>    
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta http-equiv="refresh" content="3600" />
  <link rel="stylesheet" href="maintenance.css">
  <link rel="shortcut icon" href="images/favicon.ico">
</head>

<body>

<!--<a href="file:///W:/ENZO%20Licence%20Informatique/Classeur1.xlsx">Lien</a>-->

<!-- Contenu principal -->
<div class="head"><img src="images/Logo_Web3.png" alt="Logo" id="logo"><h1 id="TV"></h1>
</div>
<!-- Partie de gauche -->
<div class="aside_gauche">
  <h1 class="NoMargin">Nombre d'ordre total</h1>
  <div id="usines">
    <p>U1</p>
    <p>U2</p>
    <p>U3</p>
    <p>LVR</p>
  </div>
  <canvas id="canvas" class="bar_graph2"></canvas>
  <div class="legende">
    <p style="color:orange">Hors délais</p>
    <p style="color:#04cf04">Ouverts prêts</p>
    <p style="color:#0051ff">Autres</p>
  </div>
  <div class="noms">
    <p>Nombre pannes ouvertes</p>
    <p>Nombre avis ouverts sans ordres</p>
  </div>
  <div class="baro">
    <canvas id="canvas1" class="bar_graph"></canvas>
    <canvas id="canvas2" class="bar_graph"></canvas>
  </div>
  <h1 class="h1SansMargin">Indicateurs maint U1</h1>
  <div class="baro">
    <canvas id="canvas3" class="bar_graph"></canvas>
    <canvas id="canvas4" class="bar_graph"></canvas>
  </div>
  <h1 class="h1SansMargin">Indicateurs maint U2</h1>
  <div class="baro">
    <canvas id="canvas5" class="bar_graph"></canvas>
    <canvas id="canvas6" class="bar_graph"></canvas>
  </div>
  <h1 class="h1SansMargin">Indicateurs maint U3</h1>
  <div class="baro">
    <canvas id="canvas7" class="bar_graph"></canvas>
    <canvas id="canvas8" class="bar_graph"></canvas>
  </div>
  <h1 class="h1SansMargin">Indicateurs maint LVR</h1>
  </div>
<!-- navigation -->
<div class="navigation">
<ul class="nav2">
    <li class="nav"><a class="dif" href="http://delphes/fr/portailSALM/Pages/Default.aspx"><p>Accueil Portail</p></a>
    <li class="nav dif"><p>Les packs</p>
      <div class="sous_menu">
        <span class="icon_bar">HOTLINE</span>
        <span class="icon_bar">FORMATION</span>
        <span class="icon_bar">MAGASINIER</span>
      </div>
    </li>
    <li class="nav"><a class="dif" href=""><p>REX</p></a>
    <li class="nav"><a class="dif" href=""><p>LP</p></a>
    <li class="nav"><a class="dif" href=""><p>Infos pratiques</p></a>
</ul>
</div>
<!-- Nouvel arrivant -->
<div class="arrivant">
  <div id="text_vertical">
    <p>A</p>
    <p>R</p>
    <p>R</p>
    <p>I</p>
    <p>V</p>
    <p>A</p>
    <p>N</p>
    <p>T</p>
  </div>
  <ul id="arrivant" style="max-width:15vw">
  <ul>
  <!-- Ici pour changer les différentes informations -->
    <li id="NA_Site"></li>
    <li id="NA_Date"></li>
    <li id="NA_Nom"></li>
    <li id="NA_Prenom"></li>
    <li id="NA_Age"></li>
    <li id="NA_Metier"></li>
    <li id="NA_Passion"></li>
  </ul>
  </ul>
  <a><img src="images/portrait.jpg"></a>
</div>
<div class="page">
<div class="news">
<div class="slideshow-container" id="slideshow">

  <!-- images qui défilent 
  <div class="mySlides fade">
    <img src="images/REX.png" style="width:100%">
  </div>

  <div class="mySlides fade">
    <img src="images/REX2.png" style="width:100%">
  </div>

  <div class="mySlides fade">
    <img width="50vw" src="images/LP2.png" style="width:100%">
  </div>

  <div class="mySlides fade">
    <img src="images/test_ethernet.jpg" style="width:100%">
  </div>-->

  <!-- Boutons souivant et précédents -->
  <a class="prev" onclick="plusSlides(-1)" style="display:none">&#10094;</a>
  <a class="next" onclick="plusSlides(1)" style="display:none">&#10095;</a>
</div>
<br>

<!-- Les poits qui permettent d'accéder aux autres photos !! ATTENTION !! changer le nombre de points si on ajoute/enlève une image -->
<div id="points"><!--
  <span class="dot" onclick="currentSlide(1)"></span> 
  <span class="dot" onclick="currentSlide(2)"></span> 
  <span class="dot" onclick="currentSlide(3)"></span>
  <span class="dot" onclick="currentSlide(4)"></span>-->
</div> 
  <!--<img style="display:none" src="transparent-arrow-hi2.png" id="fleche_gauche"><img src="" id="image1"><img style="display:none" src="transparent-arrow-hi.png" id="fleche_droite">
  </div>-->
</div>
<div class="aside_droit">
  <h1><a href="file:///\\vsm-file-1\srv_files\DP_Maintenance">Les essentiels maintenance</a></h1>
  <p id="atelier">Maintenance ateliers :</p>
  <div class="enligne">
    <a href="file:///\\vsm-file-1\srv_files\DPP\Atelier Maintenance"><img src="images/maint_u1.png"></a>
    <a href="file:///\\vsm-file-1\srv_files\DPM\07 Ateliers Maitenance\4 Atelier Maintenance SU2"><img src="images/maint_u2.png"></a>
    <a href="file:///\\vsm-file-1\srv_files\DPP\Atelier Maintenance"><img src="images/maint_u3.png"></a>
    <a href="file:///\\vsm-file-1\srv_files\DPM\07 Ateliers Maitenance\3 Atelier Maintenance LVR"><img src="images/maint_LVR.png"></a>
  </div>
  <!--<a class="info" id="organigramme" href="Organigramme.html"><img  src="images/ORGANIGRAMME.jpg"></a>
  <a class="info" id="planning" href="Planning.html"><img  src="images/Planning.jpg"></a>
  <a class="info" id="documents" href="doc.html"><img  src="images/LP.png"></a>
  -->
  <a class="enligne" href="file:///\\vsm-file-1\srv_files\DP_Sécurité"><img src="images/Securite.jpg"><p>Sécurité</p></a>
  <a class="enligne" href="file:///\\vsm-file-1\srv_files\DDI\0 Direction\3 Documents de Gestion de Projets\2 CDC et Référentiels de référence"><img src="images/CDC.jpg"><p>Cahier des charges</p></a>
  <!--<p>Listing avis</p>
  <p>Doc technique</p>
  <p>Doc machines</p>-->
  <a class="enligne" href="file:///\\vs2-maint-file\Maint\Documents SPS"><img src="images/document.png"><p>Documents SPS</p></a>
  <a class="enligne" href="file:///\\vsm-file-1\srv_files\DP_Maintenance\Annuaire.xlsm "><img src="images/annuaire.jpg"><p>Annuaire</p></a>
  <a class="enligne" href="file:///\\vsm-file-1\srv_files\DP_Maintenance\3 Communication Maintenance\1 Processus Maintenance "><img src="images/processus.jpg"><p>Processus</p></a>
  <a class="enligne" href="file:///\\vs2-maint-file\Maint\Documentation machines"><img src="images/Doc_machine.jpg"><p>Documents machines</p></a>
  <a class="enligne" href="file:///\\vs2-maint-file\Maint\Documentation technique"><img src="images/Doc_technique.jpg"><p>Documents technique</p></a>
  <a class="enligne" href="file:///\\vsm-file-1\srv_files\DP_TPM\Fonctionnement TPM "><img src="images/TPM.jpg"><p>TPM</p></a>
  <!--<p><a href="https://vsmprogtwsql.salm.int:43000/sap/bc/ui5_ui5/ui2/ushell/shells/abap/Fiorilaunchpad.html">FIORI</a></p>
  <p><a href="file:///\\vsm-file-1\srv_files\DP_Maintenance\4 Rapports GMAO & Gestion OTs\Avis Ordres Maintenance\Monté">Liste d'OT monté</a></p>
  <p><a href="file:///\\vsm-file-1\srv_files\DP_Maintenance\4 Rapports GMAO & Gestion OTs\Avis Ordres Maintenance\Panneaux">Liste d'OT panneaux</a></p>
  <p><a href="file:///\\vsm-file-1\srv_files\DPP\Atelier Maintenance\1 Organisation MPP\3 Poste Hotline\SU1\Tableau UET\En cours">Cahier de consigne U1</a></p>
  <p><a href="file:///\\vsm-file-1\srv_files\DPM\07 Ateliers Maitenance\4 Atelier Maintenance SU2\1 Organisation\2 Poste Hotline\Cahier de consignes 2020">Cahier de consigne U2</a></p>
  <p><a href="file:///\\vsm-file-1\srv_files\DPP\Atelier Maintenance\1 Organisation MPP\3 Poste Hotline\SU3\Cahier de consignes 2020">Cahier de consigne U3</a></p>
  <p><a href="file:///\\vsm-file-1\srv_files\DPM\07 Ateliers Maitenance\3 Atelier Maintenance LVR\Organisation\Consignes">Cahier de consigne LVR</a></p>
  <p><a href="http://vsm-maint-app/project.asp?loadbalancing%20no">SPV Usine</a></p>-->
</div>
</div>
<!--<input type="file" id="fileUpload" files="Salut"/>
    <input type="button" id="upload" value="Upload" onclick="UploadProcess()" />
    <br/>

    <div id="ExcelTable"></div>-->
<!--<div class="pied_de_page">
  <h1>Les différents packs</h1>
  <ul>
    <li>HOTLINE <ul>
      <li>FIORI</li>
      <li>Fichier Pannes Longues</li>
      <li>Extraction BI</li>
      <li>etc ...</li>
    </ul>
    </li>
    <li>Magasinier<ul>
      <li>Dossier fourniseur</li>
      <li>etc ...</li>
    </ul>
    </li>
    <li>Formation<ul>
      <li>Mise à jour documents</li>
      <li>Questionnaire</li>
      <li>Enquête de satisfaction en ligne</li>
      <li>Nouveaux QCM en ligne</li>
      <li>etc ...</li>
    </ul>
    </li>
    <li>etc ...</li>
  </ul>
</div>-->

</body>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript" src="https://oss.sheetjs.com/sheetjs/xlsx.full.min.js"></script> 
<script src="https://cdnjs.cloudflare.com/ajax/libs/xls/0.7.4-a/xls.core.min.js"></script>  
<script type="text/javascript">

var bouton = document.getElementsByClassName('nav')[1];
bouton.addEventListener("mouseover", function(){
  document.getElementsByClassName('sous_menu')[0].style.display="flex";
})

bouton.addEventListener("mouseout", function(){
  document.getElementsByClassName('sous_menu')[0].style.display="none";
})
bouton.addEventListener("mouseover", function(){
  document.getElementsByClassName('sous_menu')[0].style.display="flex";
})
//Changer les paramètres en fonction du navigateur utilisé
var navigateur = navigator.userAgent;
var est_ce_Edge = navigateur.indexOf("Edge");
if (est_ce_Edge != -1) //si le navigateur est Edge
{
  var arrivant = document.getElementById("text_vertical");
  //arrivant.style.display = "none";
  document.getElementById("arrivant").style.margin = "0.75vw auto 0.5vw 1vw"
  var nav = document.getElementsByClassName("navigation")
  nav[0].style.width = "50vw";
  document.getElementsByClassName("navigation")[0].style.width = null;
  document.getElementsByClassName("navigation")[0].style.width = "49vw";
}

//Recherche des valeurs pour les indicateurs
var indice_tableau = ["0","4","2","6","1","5","3","7","8","9","10","11","12","13","14","15","16","17","18","19"]; //indice des tableau en fonction de la position des valeurs dnas le tableau EXCEL indicateurs
var indice_tab = 0;
var aiguilleX = ["87","87.5","89","92","95","103","113","123","133","143","151","161","170","179","188","199","202","205","208","213"] //position en X de l'aiguille des baromètres
var aiguilleY = ["144","136","128","120","112","104","93","87","83","82","81","82","83","87","93","104","114","124","134","144"] //position en Y de l'aiguille des baromètres
var max = ["+20","+40"]; //valeurs maximum des 2 baromètres
var inter = [10,20]; //valeurs intermédiaires des 2 baromètres
var quart1 = [5,10]; //valeurs du premier quart des 2 baromètres
var quart2 = [15,30]; //valeurs dernier quart des 2 baromètres
var rayon = 100; //rayon des 2 baromètres
var valeurs;
var z = 0; //indice pour remplir le tableau extrait d'un fichier JS
var ordres = 0; //initialisation nombres des autres ordres
var ordres_prêts = 0; //initialisation nombre d'ordres ouverts prêts
var ordres_hors_delais = 0; //initialisation nombre d'ordres hors-délais
var proportion_ordres_prêts = 0; //initialisation de la proportion d'ordres prêts
var proportion_ordres_hors_delais = 0; //initialisation de la proportion d'ordres hors-délais
var proportion_ordres = 0 //initialisation de la proportion des autres ordres
var number = ["0","1","2","3","4","5","6","7","8","9"]; //table de référence des nombres 
var alphabet = ["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z",".","_",","," ","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"]; //table de référence des lettres + . + _ + , 
var decoupage = [];
var present = [true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true];

indicateurs();

//transformation de la feuille excel indicateurs_portail_maintenance en JSON pour être exploitable par JS
function indicateurs()
{
valeurs = [[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]]; //remise à vide du tableau des valeurs pour éviter un de mauvaises valeurs
var url = "Indicateurs_portail_maintenance.xlsx"; //nom du fichier contenant les chiffres pour les indicateurs (à changer si le nom change)
var oReq = new XMLHttpRequest();
oReq.open("GET", url, true);
oReq.responseType = "arraybuffer";

oReq.onload = function(e) {
var arraybuffer = oReq.response;

//convertir des valeurs en liste binaire 
var data = new Uint8Array(arraybuffer);
var arr = new Array();
for (var i = 0; i != data.length; ++i) arr[i] = String.fromCharCode(data[i]);
var bstr = arr.join("");

// appel du XLSX
var workbook = XLSX.read(bstr, {
    type: "binary"
});

// travailler avec les worksheet
var first_sheet_name = workbook.SheetNames[0];

// avoir le worksheet
var worksheet = workbook.Sheets[first_sheet_name];
var json_1 = XLSX.utils.sheet_to_json(worksheet, {
    raw: true
});
var json_2 = (JSON.stringify(json_1,null,2));
var json_stringify = JSON.stringify(json_2);
var val_decoupage = coupe_json(json_2)
var q = 0;
for (let n = 0 ; n < (val_decoupage.length)-1 ; n++)
{
  let verif = [];
  for (let g = val_decoupage[n] ; g < val_decoupage[n+1] ; g++)
  {
    verif += json_2[g]
  }
  for ( let p = 2 ; p < 6 ; p++ )
  {
    if (verif.indexOf("EMPTY_" + p) == -1)
    {
      present[q] = false;
    }
    q++
  }
}

valeurs  = transformation_value_json_to_table(json_2,present);
console.log(valeurs)

var canvas = document.getElementsByClassName('bar_graph');
var l = 0;
//dessin des différents indicateurs
for(let j = 0 ; j < canvas.length ; j++)
{
  var ctx = canvas[j].getContext('2d');
  clear_rectangle(ctx,canvas)
}
for (var i = 0 ; i < canvas.length ; i++)
{
    var ctx = canvas[i].getContext('2d');
    dessine_graph(valeurs,l,ctx,canvas);
    l++;
}

var canvas = document.getElementById('canvas');
var ctx = canvas.getContext('2d');
var b = 8;
//nettoyer l'ancien bar graph
clear_rectangle(ctx,canvas)
//fonction qui cherche le maxime d'ordres par usines
function max_somme_ordres_usines(valeurs)
{
  let b = 8;
  var somme = 0;
  var somme1 = 0;
  for (let a = 0 ; a < 4 ; a++)
  {
    somme1 = Number.parseInt(valeurs[b]) + Number.parseInt(valeurs[b+4]) + Number.parseInt(valeurs[b+8]);
    if (a%2 == 0)
      b += 2
    else if (a%2 == 1)
      b -= 1
    if (somme < somme1)
      somme = somme1
  }
  return somme
}
var maximum = max_somme_ordres_usines(valeurs)
for (let a = 0 ; a < 4 ; a++)
{
  ordres = valeurs[b];
  ordres_prêts = valeurs[b+4];
  ordres_hors_delais = valeurs[b+8];
  if (a%2 == 0)
    b += 2
  else if (a%2 == 1)
    b -= 1
  dessine_bar_graph(a,ctx,canvas,maximum);
}
}
oReq.send();
var now = new Date()
  if (now.getMinutes() == 1)
  {
    setTimeout(indicateurs,3600)
  }
  else
  {
    console.log("Je dois me voir")
    var now = new Date()
    var heure = now.getMinutes()
    var minutes = 60 - heure;
    console.log(minutes)
    setTimeout(indicateurs,1000*60*(minutes + 3))
  }
}

//extraire les différentes données d'un fichier json
function transformation_value_json_to_table(json,present)
{
  z = 0;
    var i = 1;
    while(json[i]!="]")
    {
        i++;
    }
    var taille = i+2;
    for (let j=0;j<taille;j++)
    {
      if (present[z] == true)
        {
          if (json[j] == ":")
        {
            if (!(isNaN(json[j+2])))
            {
                var taille2 = parseInt(j)+2;
            
                while (est_dans(number,json[taille2]))
                {
                    valeurs[z] += json[taille2];
                    taille2++;
                }
                if (!(isNaN(valeurs[z])) || valeurs[z] == null )  
                  z++;  
            }
        }
          }
        else if (present[z] == false)
        {
          valeurs[z] = "0";
          z++
        }
    }
  return valeurs;
}

function coupe_json(json)
{
  let y = 0;
  for (var m = 0; m < json.length ; m++)
  {
    if (json[m]=="N")
    {
      if (json[m+1]=="b")
      {
        decoupage[y] = m;
        y++
      }
    }
  }
  decoupage[y] = json.length;
  return decoupage;
}

//fonction de vérification si un élément appartient à une table
function est_dans(tab,x)
{
    for(let k=0;k<tab.length;k++)
    {
        if (x == tab[k])
            return true
    }
    return false
}

//------------------------------------------------------------------------------------------------------------------------------------------
//transformation de la feuille excel images en JSON pour être exploitable par JS
var url2 = "images.xlsx";
var oReq2 = new XMLHttpRequest();
oReq2.open("GET", url2, true);
oReq2.responseType = "arraybuffer";
var valeurs2 = new Array();

oReq2.onload = function(e) {
var arraybuffer2 = oReq2.response;

//convertir des valeurs en liste binaire 
var data2 = new Uint8Array(arraybuffer2);
var arr2 = new Array();
for (var i = 0; i != data2.length; ++i) 
arr2[i] = String.fromCharCode(data2[i]);
var bstr2 = arr2.join("");

// appel du XLSX
var workbook2 = XLSX.read(bstr2, {
    type: "binary"
});

// travailler avec les worksheet
var first_sheet_name2 = workbook2.SheetNames[0];

// avoir le worksheet
var worksheet2 = workbook2.Sheets[first_sheet_name2];
var test42 = XLSX.utils.sheet_to_json(worksheet2, {
    raw: true
});
var test22 = (JSON.stringify(test42,null,2));
var essai = JSON.parse(test22)
console.log(essai)
console.log(essai[0].source)
var test23 = JSON.stringify(test22);
valeurs2 = transformation_text_json_to_table(test23);
ajout_images(valeurs2);
var slides = document.getElementsByClassName("mySlides");
carousel(slides);
}

function transformation_text_json_to_table(test23)
{
  var e = 0;
  for (let f=0 ; f < test23.length ; f++)
  {
    if(test23[f] == "\"")
    {
      if (est_dans(alphabet,test23[f+1]))
      {
        var c = 1;
        while(est_dans(alphabet,test23[f+c]) || est_dans(number,test23[f+c]))
        {
          if (c == 1)
            valeurs2[e] = test23[f+c]
          else
            valeurs2[e] += test23[f+c];
          c++;
        }
        if(valeurs2[e] != ("photo"))
          e++;
      }
    }
  }
  return valeurs2;
}

oReq2.send();

//fonction qui ajoute les images
function ajout_images(valeurs2)
{
  var elt2 = document.createElement("div");
    elt2.setAttribute("id","deuxieme");
    document.getElementById("slideshow").appendChild(elt2);
  for (let h = 0 ; h < valeurs2.length ; h++)
  {
      if (!valeurs2[h].indexOf("REX"))
      {
        var elt1 = document.createElement("a");
        elt1.setAttribute("href","file:///\\vsm-file-1\srv_files\DP_Maintenance\Monitorat    JHe");
      }
      else if (!valeurs2[h].indexOf("LP"))
      {
        var elt1 = document.createElement("a");
        elt1.setAttribute("href","file:///\\vsm-file-1\srv_files\DP_Maintenance\Monitorat    JHe");
      }
      else
      {
        var elt1 = document.createElement("div");
      }
    
    elt1.setAttribute("class","mySlides");
    elt1.setAttribute("id","image"+h);
    document.getElementById("deuxieme").appendChild(elt1);
    let elt = document.createElement("img");
    elt.setAttribute("src","images/"+valeurs2[h]);
    elt.setAttribute("style","width:100%")
    document.getElementById("image"+h).appendChild(elt);
    let dots = document.createElement("span");
    dots.setAttribute("class","dot");
    let index = h+1;
    dots.setAttribute("onclick","currentSlide("+index+")")
    document.getElementById("points").appendChild(dots);
  }
}

//------------------------------------------------------------------------------------------------------------------------------------------
//transformation de la feuille excel arrivant en JSON pour être exploitable par JS
var url3 = "arrivant.xlsx";
var oReq3 = new XMLHttpRequest();
oReq3.open("GET", url3, true);
oReq3.responseType = "arraybuffer";
var valeurs3 = new Array();

oReq3.onload = function(e) {
var arraybuffer3 = oReq3.response;

//convertir des valeurs en liste binaire 
var data3 = new Uint8Array(arraybuffer3);
var arr3 = new Array();
for (var i = 0; i != data3.length; ++i) 
arr3[i] = String.fromCharCode(data3[i]);
var bstr2 = arr3.join("");

// appel du XLSX
var workbook3 = XLSX.read(bstr2, {
    type: "binary"
});

// travailler avec les worksheet
var first_sheet_name3 = workbook3.SheetNames[0];

// avoir le worksheet
var worksheet3 = workbook3.Sheets[first_sheet_name3];
var json_text = XLSX.utils.sheet_to_json(worksheet3, {
    raw: true
});
var arr_string1 = (JSON.stringify(json_text,null,2));
var arr_string2 = JSON.stringify(arr_string1);
valeurs3 = transformation_text_json_to_table_arrivant(arr_string2);
ajout_nv_arrivant(valeurs3);
}

oReq3.send()

function transformation_text_json_to_table_arrivant(test23)
{
  let e = 0;
  for (let f=0 ; f < test23.length ; f++)
  {
    if(test23[f] == "\"")
    {
      if (est_dans(alphabet,test23[f+1]) || est_dans(number,test23[f+1]))
      {
        let c = 1;
        while(est_dans(alphabet,test23[f+c]) || est_dans(number,test23[f+c]))
        {
          if (c == 1)
            valeurs3[e] = test23[f+c]
          else
            valeurs3[e] += test23[f+c];
          c++;
        }
        if((valeurs3[e] != ("ARRIVANT")) && (valeurs3[e] != ("Arrivant")))
          e++;
        f += c;
      }
    }
    else if (est_dans(number,test23[f]))
    {
      let c = 0;
        while(est_dans(number,test23[f+c]))
        {
          if (c == 0)
            valeurs3[e] = test23[f+c]
          else
            valeurs3[e] += test23[f+c];
          c++;
        }
        if((valeurs3[e] != ("ARRIVANT")) && (valeurs3[e] != ("Arrivant")))
          e++;
        f += c;
    }
  }
  return valeurs3;
}


function ajout_nv_arrivant(valeurs3)
{
  let h = 0;
    document.getElementById("NA_Site").textContent = "Site : " + valeurs3[h];
    h++;
    document.getElementById("NA_Date").textContent = "Date : " + valeurs3[h];
    h++;
    document.getElementById("NA_Nom").textContent = "Nom : " + valeurs3[h];
    h++;
    document.getElementById("NA_Prenom").textContent = "Prénom : " + valeurs3[h];
    h++;
    document.getElementById("NA_Age").textContent = "Age : " + valeurs3[h];
    h++;
    document.getElementById("NA_Metier").textContent = "Metier : " + valeurs3[h];
    h++;
    document.getElementById("NA_Passion").textContent = "Passion : " + valeurs3[h];
    h++;
}

//--------------------------------------------------------------------------------------------------------------------------------------------
//calculs proportions bar graph
//fonction qui calcul la proportion de chaque ordres en fonction de l'usine
function proportion(maximum)
{
  proportion_ordres = ordres / maximum;
  proportion_ordres_prêts = ordres_prêts / maximum;
  proportion_ordres_hors_delais = ordres_hors_delais/maximum;
}

function dessine_bar_graph(i,ctx,canvas,maximum)
{
  //calcul de la proportion pour chaques couches du graph
  proportion(maximum);
  //écriture de l'échelle
  if (i == 0) //uniquement lors du premier passage
  {
    ctx.beginPath()
    ctx.font = '0.9vw serif';
    ctx.fillStyle = 'black';
    ctx.fillText(maximum, 10, 10);
    ctx.fillText(Number.parseInt(maximum/2), 10, 79);
    ctx.fillText(maximum, 10, 10);
    ctx.fillText(Number.parseInt(maximum/2), 10, 79);
    ctx.stroke();
    ctx.beginPath();
    ctx.strokeStyle = 'black';
    ctx.lineWidth = '3';
    ctx.moveTo(40,2);
    ctx.lineTo(297,2);
    ctx.stroke();
    ctx.moveTo(40,71);
    ctx.lineTo(302,71);
    ctx.stroke();
    ctx.restore();
  }
  var maximale = 150; //taille maximale en pixel
  var hauteurmax = maximale - (proportion_ordres_hors_delais * maximale + proportion_ordres_prêts * maximale + proportion_ordres * maximale)
  var hauteur3 = proportion_ordres_hors_delais * maximale + proportion_ordres_prêts * maximale + proportion_ordres * maximale
  var hauteur2 = proportion_ordres_hors_delais * maximale + proportion_ordres_prêts * maximale
  var hauteur1 = proportion_ordres_hors_delais * maximale;
  var hauteurDep = [hauteurmax,hauteurmax+hauteur1,hauteurmax+hauteur2]; //hauteur de départ des différentes couches du graph
  var hauteur = [hauteurmax+hauteur1,hauteurmax+hauteur2,hauteurmax+hauteur3]; //hauteur de final de différentes couches du graph
  var couleur = ['#04cf04',"#0051ff",'orange']; //couleurs des différentes couches
  var positionX = [51,112,175,242]; // position horizontale des barres
  //dessin du bar graph
  for (let j = 0 ; j<hauteur.length; j++)
  {
    ctx.beginPath();
    ctx.strokeStyle = couleur[j];
    ctx.lineTo(positionX[i], hauteur[j]);
    ctx.stroke();
    ctx.lineTo(positionX[i]+40,hauteur[j]);
    ctx.stroke();
    ctx.lineTo(positionX[i]+40,hauteurDep[j]);
    ctx.stroke();
    ctx.lineTo(positionX[i],hauteurDep[j]);
    ctx.stroke();
    ctx.fillStyle = couleur[j];
    ctx.fill();
    ctx.stroke();
   }
}

function clear_rectangle(ctx,canvas)
{
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.closePath()
}

//---------------------------------------------------------------------------------------------------------------------------------

var slideIndex = 0;
var interval = 5; //temps de changement de chaque diapo
var stopCarousel = false;
var timeOut;
var dessus_image;


//fonction qui permet de faire défiler les images
function carousel(slides) {
  if (!stopCarousel)
  {
  var i;
  var x = document.getElementsByClassName("mySlides");
  var dots = document.getElementsByClassName("dot");
  for (i = 0; i < x.length; i++) 
    {
      x[i].style.display = "none";  
    }
  slideIndex++;
  if (slideIndex > x.length)
    {
      slideIndex = 1
    }    
  x[slideIndex-1].style.display = "block";

  for (i = 0; i < dots.length; i++)
    {
      dots[i].className = dots[i].className.replace(" active", "");
    }
  dots[slideIndex-1].className += " active";
  slideIndex = slideIndex%(dots.length); //modulo le nombre de photos
  timeOut = setTimeout(carousel, interval*1000); // Change toutes les intervalles
  }
}

//showSlides(slideIndex,slides);

// Next/previous controls
function plusSlides(n,slides) {
  showSlides(slideIndex += n,slides);
}

// Thumbnail image controls
function currentSlide(n,slides) {
  showSlides(slideIndex = n,slides);
}

function showSlides(n,slides) {
  if (!dessus_image)
    clearTimeout(timeOut);
  var i;
  var slides = document.getElementsByClassName("mySlides");
  var dots = document.getElementsByClassName("dot");
  if (n > slides.length)
    {
        slideIndex = 1
    } 
  if (n < 1) 
    {
      slideIndex = slides.length
    }
  for (i = 0; i < slides.length; i++) 
    {
      slides[i].style.display = "none"; 
    }
  for (i = 0; i < dots.length; i++)
    {
      dots[i].className = dots[i].className.replace(" active", "");
    }
  slides[slideIndex-1].style.display = "block"; 
  dots[slideIndex-1].className += " active";
  /*if (!dessus_image)
    timeOut = setTimeout(carousel, interval*1000);*/
  dessus_image = false
} 

var slideAct = document.getElementById("slideshow");

slideAct.addEventListener("mouseover",function(){
  clearTimeout(timeOut);
  document.getElementsByClassName("next")[0].style.background = "rgba(0,0,0,0.8)";
  document.getElementsByClassName("prev")[0].style.background = "rgba(0,0,0,0.8)";
  document.getElementsByClassName("next")[0].style.display = "";
  document.getElementsByClassName("prev")[0].style.display = "";
  dessus_image = true
});

slideAct.addEventListener("mouseout", function(){
  document.getElementsByClassName("next")[0].style.display = "none";
  document.getElementsByClassName("prev")[0].style.display = "none";
  document.getElementsByClassName("next")[0].style.background = "";
  document.getElementsByClassName("prev")[0].style.background = "";
  timeOut = setTimeout(carousel, interval*1000);
});

var news = document.getElementsByClassName("news")[0];

news.addEventListener("mouseover", function(){
  document.getElementById("points").style.display = "block";
});

news.addEventListener("mouseout", function(){
  document.getElementById("points").style.display = "none";
});

//point en x de l'aiguille
var x = ["35","35","35","36","37","38.5","40","42","44","45","49","53","58","61","65","69","74","78","83","88","92","97","101","105","108","113","117","121","122","124","126","127.5","129","130","131","131","131"];
//point en y de l'aiguille
var y = ["95","91.5","88","84.5","81","77.5","74","70.5","67","65","61.5","58","54.5","53","51","50","49","48","48","48","49","50","51","53","54.5","58","61.5","65","67","70.5","74","77.5","81","84.5","88","91.5","95"];

//-----------------------------------------------------------------------------------------------------------------------------

//partie indicateurs

function calcul_longueur(x1,y1,x2,y2)
{
  return Math.sqrt(((x2-x1)*(x2-x1))+((y2-y1)*(y2-y1)))
};

function Norm(xA,yA,xB,yB) {
  return Math.sqrt(Math.pow(xB-xA,2)+Math.pow(yB-yA,2));
} 

function Vecteur (xA,yA,xB,yB,ArrowLength,ArrowWidth,ctx) {
  xA = parseFloat(xA) 
  yA = parseFloat(yA)
  xB = parseFloat(xB)
  yB = parseFloat(yB)
  if (ArrowLength === undefined) {ArrowLength=10;} 
  if (ArrowWidth === undefined) {ArrowWidth=8;} 
  ctx.lineCap="round"; 
// Calculs des coordonnées des points C, D et E 
  AB=Norm(xA,yA,xB,yB); 
  xC=xB+ArrowLength*(xA-xB)/AB;yC=yB+ArrowLength*(yA-yB)/AB; 
  xD=xC+ArrowWidth*(-(yB-yA))/AB;yD=yC+ArrowWidth*((xB-xA))/AB; 
  xE=xC-ArrowWidth*(-(yB-yA))/AB;yE=yC-ArrowWidth*((xB-xA))/AB; 
  // et on trace le segment [AB], et sa flèche: 
  ctx.beginPath(); 
  ctx.moveTo(xA,yA);ctx.lineTo(xB,yB); 
  ctx.moveTo(xD,yD);ctx.lineTo(xB,yB);ctx.lineTo(xE,yE); 
  ctx.stroke(); 
} 

function dessine_graph(valeurs,i,ctx,canvas)
{
    //dessin du quart rouge
    ctx.beginPath();
    ctx.strokeStyle = 'red';
    ctx.arc(150,150,100,(7/4)*Math.PI,2*Math.PI);
    ctx.stroke();
    ctx.lineTo(150,150);
    ctx.stroke();
    ctx.fillStyle = 'red'
    ctx.fill();
    ctx.stroke();
    ctx.restore();

    ctx.beginPath();
    ctx.strokeStyle = 'orange';
    ctx.arc(150,150,100,(3/2)*Math.PI,(7/4)*Math.PI);
    ctx.stroke();
    ctx.lineTo(150,150);
    ctx.stroke();
    ctx.fillStyle = "orange"
    ctx.fill();
    ctx.stroke();
    ctx.restore();

    ctx.beginPath();
    ctx.strokeStyle = 'yellow';
    ctx.arc(150,150,100,(5/4)*Math.PI,(3/2)*Math.PI);
    ctx.stroke();
    ctx.lineTo(150,150);
    ctx.stroke();
    ctx.fillStyle = "yellow"
    ctx.fill();
    ctx.stroke();
    ctx.restore();

    ctx.beginPath();
    ctx.strokeStyle = '#00c427';
    ctx.arc(150,150,100,Math.PI,(5/4)*Math.PI);
    ctx.stroke();
    ctx.lineTo(150,150);
    ctx.stroke();
    ctx.fillStyle = "#00c427"
    ctx.fill();
    ctx.stroke();
    ctx.restore();
    
    ctx.beginPath();
    ctx.strokeStyle = 'black';
    ctx.lineWidth = "20";
    ctx.arc(150,150,10,Math.PI,2*Math.PI);
    ctx.stroke();
    ctx.restore();
    ctx.closePath();
    if (i%2 == 0)
    {
      indice_tab = valeurs[indice_tableau[i]]
    }
    if (i%2 == 1)
    {
      if (valeurs[indice_tableau[i]] < 40)
      {
        indice_tab = Math.trunc(valeurs[indice_tableau[i]] / 2)
      }
      else
      {
        indice_tab = 19
      }
    }

    ctx.beginPath();
    ctx.strokeStyle = 'white';
    ctx.lineWidth = "3";
    /*ctx.arc(150,150,100,Math.PI,2*Math.PI);
    ctx.stroke();*/
    ctx.lineTo(0,150);
    ctx.stroke();
    ctx.restore();

    ctx.clearRect(1,1,canvas.width,canvas.height)
    ctx.font = '1.5vw serif';
    ctx.fillStyle = 'black';
    ctx.fillText('0',30,150);
    ctx.fillText(quart1[i%2], 50, 80);
    ctx.fillText(inter[i%2], 138, 40);
    ctx.fillText(quart2[i%2], 225, 80);
    ctx.fillText(max[i%2], 256, 150);
    ctx.restore();

    ctx.strokeStyle = 'black';   
    ctx.lineWidth = "6";
    Vecteur(151,144,aiguilleX[indice_tab],aiguilleY[indice_tab],10,9,ctx);
  };
   
</script>
</html>
